<div class="row" style="margin:5px;">
  <button mat-raised-button color="primary" (click)="newDocument()">Crear documento</button>
</div>
<div [ngClass]="showFormPanel ? 'row' : 'row justify-content-center'">
  <mat-card [ngClass]="showFormPanel ? 'col-sm-12 col-md-5' : 'col-sm-12 col-md-7'">
    <input placeholder="Buscar documento" class="search" (keyup)="searchDocuments()" [(ngModel)]="searchText"
      oninput="this.value = this.value.toUpperCase()">
    <mat-selection-list class="documents-list">
      <mat-list-item *ngFor="let doc of documents" class="document-card">
        <mat-card>
          <mat-card-header>
            <mat-card-title>
              <mat-chip-list selectable="false">
                <span *ngFor="let department of doc.departments" >
                  <span class="department-chip">{{ department }}</span>
                </span>
              </mat-chip-list>
            </mat-card-title>
            <mat-card-subtitle>{{ doc.name }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-actions align="end">
            <button mat-button (click)="viewDocument(doc)">Ver</button>
            <button mat-button color="primary" (click)="editDocument(doc)">Editar</button>
            <button [disabled]="doc.departments.length !== 0" mat-button color="warn" (click)="removeDocument(doc)">Eliminar</button>
          </mat-card-actions>
        </mat-card>
      </mat-list-item>
    </mat-selection-list>
  </mat-card>
  <mat-card class="col-sm-12 col-md-7" *ngIf="showFormPanel">
    <span class="float-right close" placement="top" ngbTooltip="Cerrar">
      <fa name="times-circle" (click)="closeFormPanel()" style="color:red"></fa>
    </span>
    <form [formGroup]="documentForm" (ngSubmit)="saveDocument()">
      <mat-card-title>{{ titleCardForm }}</mat-card-title>
      <mat-card-content class="card-body">
        <div class="form-group">
          <label class="form-col-form-label" for="strategicProcess">Proceso estratégico:</label>
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text"><i class="fa fa-cog"></i></span>
            </div>
            <input type="text" [ngClass]="(!documentForm.get('strategicProcess').valid &&
                  documentForm.get('strategicProcess').touched)?'form-control is-invalid':'form-control'"
              id="strategicProcess" formControlName="strategicProcess" placeholder="Proceso estratégico" oninput="this.value =
                  this.value.toUpperCase()">
            <div class="invalid-feedback"
              *ngIf="!documentForm.get('strategicProcess').valid && documentForm.get('strategicProcess').touched">
              <span *ngIf="documentForm.get('strategicProcess').errors['required']">
                ¡Por favor ingrese el proceso estratégico!
              </span>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12 col-lg-6">
            <label class="form-col-form-label" for="key">Clave:</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text"><i class="fa fa-key"></i></span>
              </div>
              <input type="text" [ngClass]="(!documentForm.get('key').valid &&
                  documentForm.get('key').touched)?'form-control is-invalid':'form-control'" id="key"
                formControlName="key" placeholder="Clave" oninput="this.value =
                  this.value.toUpperCase()">
              <div class="invalid-feedback" *ngIf="!documentForm.get('key').valid && documentForm.get('key').touched">
                <span *ngIf="documentForm.get('key').errors['required']">
                  ¡Por favor ingrese la clave!
                </span>
              </div>
            </div>
          </div>
          <div class="form-group col-md-12 col-lg-6">
            <label class="form-col-form-label" for="code">Código:</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text"><i class="fa fa-code"></i></span>
              </div>
              <input type="text" [ngClass]="(!documentForm.get('code').valid &&
                  documentForm.get('code').touched)?'form-control is-invalid':'form-control'" id="code"
                formControlName="code" placeholder="Código" oninput="this.value =
                  this.value.toUpperCase()">
              <div class="invalid-feedback" *ngIf="!documentForm.get('code').valid && documentForm.get('code').touched">
                <span *ngIf="documentForm.get('code').errors['required']">
                  ¡Por favor ingrese el código!
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="form-col-form-label" for="operativeProcess">Proceso operativo:</label>
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text"><i class="fa fa-cog"></i></span>
            </div>
            <input type="text" [ngClass]="(!documentForm.get('operativeProcess').valid &&
                  documentForm.get('operativeProcess').touched)?'form-control is-invalid':'form-control'"
              id="operativeProcess" formControlName="operativeProcess" placeholder="Proceso operativo" oninput="this.value =
                  this.value.toUpperCase()">
            <div class="invalid-feedback"
              *ngIf="!documentForm.get('operativeProcess').valid && documentForm.get('operativeProcess').touched">
              <span *ngIf="documentForm.get('operativeProcess').errors['required']">
                ¡Por favor ingrese el proceso operativo!
              </span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="form-col-form-label" for="procedure">Procedimiento:</label>
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text"><i class="fa fa-th-list"></i></span>
            </div>
            <input type="text" [ngClass]="(!documentForm.get('procedure').valid &&
                  documentForm.get('procedure').touched)?'form-control is-invalid':'form-control'" id="procedure"
              formControlName="procedure" placeholder="Procedimiento" oninput="this.value =
                  this.value.toUpperCase()">
            <div class="invalid-feedback"
              *ngIf="!documentForm.get('procedure').valid && documentForm.get('procedure').touched">
              <span *ngIf="documentForm.get('procedure').errors['required']">
                ¡Por favor ingrese el procedimiento!
              </span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="form-col-form-label" for="name">Nombre:</label>
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text"><i class="fa fa-file-text"></i></span>
            </div>
            <input type="text" [ngClass]="(!documentForm.get('name').valid &&
                  documentForm.get('name').touched)?'form-control is-invalid':'form-control'" id="name"
              formControlName="name" placeholder="Nombre" oninput="this.value =
                  this.value.toUpperCase()">
            <div class="invalid-feedback" *ngIf="!documentForm.get('name').valid && documentForm.get('name').touched">
              <span *ngIf="documentForm.get('name').errors['required']">
                ¡Por favor ingrese el nombre!
              </span>
            </div>
          </div>
        </div>
      </mat-card-content>
      <mat-card-actions align="end" *ngIf="!isViewDetails" style="padding:8px;margin:0px;">
        <button type="submit" mat-button color="primary" [disabled]="documentForm.invalid">Guardar</button>
        <button type="button" mat-button color="warn" (click)="documentForm.reset()">Limpiar</button>
      </mat-card-actions>
    </form>
  </mat-card>
</div>
