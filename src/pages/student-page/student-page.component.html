<ng-template #content let-c="close('Save click')" let-d="dismiss('Cross click')" let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Seleccione el área de la foto</h4>
    <button type="button" class="close" aria-label="Close" (click)="d">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">

    <image-cropper [imageChangedEvent]="imageChangedEvent" [maintainAspectRatio]="true" [aspectRatio]="2.5 / 3" format="png"
      (imageCropped)="imageCropped($event)" (imageLoaded)="imageLoaded()" (loadImageFailed)="loadImageFailed()"></image-cropper>

  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-login" (click)="c">Actualizar</button>
    <button type="button" class="btn btn-link" (click)="d">Cancelar</button>
  </div>
</ng-template>

<div class="content-general">
  <div *ngIf="showForm" class="card card-shadow" style="margin-bottom: 15px;">
    <div class="card-header">
      <span class="float-right close" placement="top" ngbTooltip="Cerrar">
        <fa name="times-circle" (click)="hiddenFormDiv()"></fa>
      </span>
      <span class="float-right close">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      </span>
      <span *ngIf="!this.formStudent.invalid" class="float-right close" placement="top" ngbTooltip="Imprimir">
        <fa name="print" (click)="generatePDF(currentStudent)" style="color:#ED773C"></fa>
      </span>
      <span class="float-right close">
        &nbsp;&nbsp;
      </span>
      <span *ngIf="!this.formStudent.invalid&&!isNewStudent" class="float-right close" placement="top" ngbTooltip="Guardar">
        <fa name="save" (click)="updateStudentData();" style="color:green"></fa>
      </span>
      <span *ngIf="!this.formStudent.invalid&&isNewStudent" class="float-right close" placement="top" ngbTooltip="Guardar">
        <fa name="save" (click)="newStudentData();" style="color:greenyellow"></fa>
      </span>
      <!-- <button *ngIf="!isNewStudent" type="button" (click)="updateStudentData();" class="btn btn-login btn-lg float-right">Actualizar</button> -->
      <strong>Datos del Alumno</strong>
    </div>
    <div class="card-body">
      <form [formGroup]="formStudent">
        <div class="row">
          <div class="col-12 col-lg-4">

            <div class="row" style="justify-content: center">
              <div style="display: flex; height: 100%;">
                <div class="container-img">
                  <div *ngIf="showImg">
                    <input type="file" (change)="fileChangeEvent($event, content)" id="fileButton" accept="image/x-png,image/jpeg"
                      style="display: none;">
                    <div (click)="showSelectFileDialog()" class="tag">Actualizar foto</div>
                    <img class="profile-icon" [src]="photoStudent">
                  </div>
                  <div *ngIf="!showImg">
                    <div class="cssload-thecube">
                      <div class="cssload-cube cssload-c1"></div>
                      <div class="cssload-cube cssload-c2"></div>
                      <div class="cssload-cube cssload-c4"></div>
                      <div class="cssload-cube cssload-c3"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-8">
            <div class="form-group">
              <label for="studentInputFullName">Nombre Completo *</label>
              <input (input)="errorInputsTag.errorStudentFullName = false" #input (input)="input.value=$event.target.value.toUpperCase()"
                type="text" class="form-control" id="studentInputFullName" formControlName="fullNameInput"
                aria-describedby="emailHelp" placeholder="Ingrese nombre completo" [ngClass]="{'is-invalid': (formStudent.get('fullNameInput').errors && formStudent.get('fullNameInput').dirty) || errorInputsTag.errorStudentFullName }">
              <div *ngIf="(formStudent.get('fullNameInput').errors && formStudent.get('fullNameInput').dirty) || errorForm">
                <div class="invalid-feedback" *ngIf="formStudent.get('fullNameInput').hasError('required') || errorInputsTag.errorStudentFullName">
                  Campo obligatorio
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="exampleFormControlSelect1">Carrera *</label>
              <select (input)="errorInputsTag.errorStudentCareer = false" class="form-control" id="exampleFormControlSelect1"
                [ngClass]="{ 'is-invalid' : errorInputsTag.errorStudentCareer }" [(ngModel)]="currentStudent.career"
                [ngModelOptions]="{standalone: true}">
                <option value="default" selected>Seleccione la Carrera</option>
                <option value="ARQUITECTURA">ARQUITECTURA</option>
                <option value="INGENIERÍA BIOQUÍMICA">INGENIERÍA BIOQUÍMICA</option>
                <option value="INGENIERÍA CIVIL">INGENIERÍA CIVIL</option>
                <option value="INGENIERÍA ELÉCTRICA">INGENIERÍA ELÉCTRICA</option>
                <option value="INGENIERÍA EN GESTIÓN EMPRESARIAL">INGENIERÍA EN GESTIÓN EMPRESARIAL</option>
                <option value="INGENIERÍA INDUSTRIAL">INGENIERÍA INDUSTRIAL</option>
                <option value="INGENIERÍA MECATRÓNICA">INGENIERÍA MECATRÓNICA</option>
                <option value="INGENIERÍA QUÍMICA">INGENIERÍA QUÍMICA</option>
                <option value="INGENIERÍA EN SISTEMAS COMPUTACIONALES">INGENIERÍA EN SISTEMAS COMPUTACIONALES</option>
                <option value="INGENIERÍA EN TECNOLOGÍAS DE LA INFORMACIÓN Y COMUNICACIONES">INGENIERÍA EN TECNOLOGÍAS
                  DE LA INFORMACIÓN Y COMUNICACIONES</option>
                <option value="LICENCIATURA EN ADMINISTRACIÓN">LICENCIATURA EN ADMINISTRACIÓN</option>
                <option value="MAESTRIA EN CIENCIAS DE ALIMENTOS">MAESTRIA EN CIENCIAS DE ALIMENTOS</option>
                <option value="DOCTORADO EN CIENCIAS DE ALIMENTOS">DOCTORADO EN CIENCIAS DE ALIMENTOS</option>
              </select>
              <div class="invalid-feedback" *ngIf="errorInputsTag.errorStudentCareer">
                Campo obligatorio
              </div>
            </div>

            <div class="form-group">
              <label for="studentInputControlNumber">Número de Control *</label>
              <input (input)="errorInputsTag.errorStudentNumberControl = false" type="text" class="form-control" id="studentInputFullName"
                formControlName="numberControlInput" aria-describedby="emailHelp" placeholder="Ingrese numero de control"
                [ngClass]="{'is-invalid': (formStudent.get('numberControlInput').errors && formStudent.get('numberControlInput').dirty) || errorInputsTag.errorStudentNumberControl }">
              <div *ngIf="(formStudent.get('numberControlInput').errors && formStudent.get('numberControlInput').dirty) || errorForm">
                <div class="invalid-feedback" *ngIf="formStudent.get('numberControlInput').hasError('required') || errorInputsTag.errorStudentNumberControl">
                  Campo obligatorio
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="studentInputNSS">NSS *</label>
              <input (input)="errorInputsTag.errorStudentNSS = false" type="text" class="form-control" id="studentInputNSS"
                formControlName="nssInput" aria-describedby="emailHelp" placeholder="Ingrese numero de seguro social"
                [ngClass]="{'is-invalid': (formStudent.get('nssInput').errors && formStudent.get('nssInput').dirty) || errorInputsTag.errorStudentNSS }">
              <div *ngIf="(formStudent.get('nssInput').errors && formStudent.get('nssInput').dirty) || errorForm">
                <div class="invalid-feedback" *ngIf="formStudent.get('nssInput').hasError('required') || errorInputsTag.errorStudentNSS">
                  Campo obligatorio
                </div>
              </div>
            </div>

          </div>
        </div>
        <!--<div class="row">
           <div class="col-12 col-lg-4 text-center d-none d-lg-block">
            <button type="button" (click)="generatePDF(currentStudent)" class="btn btn-itt btn-block btn-lg">
              Imprimir
            </button>
             <button type="button" (click)="generatePDF(currentStudent)" class="btn btn-itt btn-block btn-sm d-lg-none">
              Generar credencial
            </button> 
          </div> 
           <div class="col-8 d-none d-lg-block">
             <button type="button" (click)="hiddenFormDiv()" class="btn btn-link btn-lg float-right">Cerrar</button> 
             <button *ngIf="!isNewStudent" type="button" (click)="updateStudentData();" class="btn btn-login btn-lg float-right">Actualizar</button> 
            <button *ngIf="isNewStudent" type="button" (click)="newStudentData();" class="btn btn-login btn-lg float-right">Guardar</button>
          </div>
          <div class="col-12 d-lg-none">
            <div class="row">
              <div class="col-12">
                 <button type="button" (click)="generatePDF(currentStudent)" class="btn btn-itt btn-block btn-sm">
                  Generar credencial
                </button> 
                 <button *ngIf="!isNewStudent" type="button" (click)="updateStudentData();" class="btn btn-login btn-sm btn-block">Actualizar</button> 
                <button *ngIf="isNewStudent" type="button" (click)="newStudentData();" class="btn btn-login btn-sm btn-block">Guardar</button>
              </div>
            </div>
          </div> 
        </div>-->
      </form>
    </div>
  </div>

  <div class="card card-shadow">
    <div class="card-header">
      <span class="close float-right" placement="top" ngbTooltip="Nuevo">
        <fa name="plus-circle" (click)="newStudent()" style="color:blue" ></fa>
      </span>
      <strong>Búsqueda de alumnos</strong>
    </div>
    <div class="card-body">
      <!-- <div class="search-div">
        <div class="form-group item1" style="margin-bottom: 10px;">
          <input type="text" #searchinput class="form-control" aria-describedby="searchHelp" placeholder="Buscar alumno por Nombre o Número de Control"
            [(ngModel)]="search" (keyup.enter)="searchStudent(false)" [ngModelOptions]="{standalone: true}">
        </div>
        <div class="item2">
          <div class="col-12">
            <button type="button" class="btn btn-success show-button-1" (click)="searchStudent(false)">
              Buscar
            </button>
          </div>
          <button type="button" style="width: 100%" class="btn btn-success show-button-2" (click)="searchStudent(false)">
            <i style="font-size:18px" class="fa fa-plus-square">+</i>
          </button>
        </div>
      </div> -->
      <div class="d-none d-sm-block">
        <div class="row">
          <div class="col-10">
            <div class="form-group" style="margin-bottom: 10px;">
              <input type="text" #searchinput class="form-control" aria-describedby="searchHelp" placeholder="Nombre o Número de Control"
                [(ngModel)]="search" (keyup.enter)="searchStudent(false)" [ngModelOptions]="{standalone: true}">
            </div>
          </div>
          <div class="col-2 ">
            <button type="button" [disabled]="!searchinput.value" class="btn btn-success btn-block" (click)="searchStudent(false)">
              Buscar
            </button>
          </div>
        </div>
      </div>
      <div class="d-block d-sm-none">
        <div class="row">
          <div class="col-10">
            <div class="form-group" style="margin-bottom: 10px;">
              <input type="text" #searchinput class="form-control" aria-describedby="searchHelp" placeholder="Nombre o Número de Control"
                [(ngModel)]="search" (keyup.enter)="searchStudent(false)" [ngModelOptions]="{standalone: true}">
            </div>
          </div>
          <div class="col-2">
            <button type="button" (click)="searchStudent(false)" [disabled]="!searchinput.value">
              <fa name="search" ></fa>
            </button>
          </div>
        </div>
      </div>



      <div *ngIf="showTable" class="table-responsive d-none d-lg-block">
        <table class="table table-bordered table-hover table-striped">
          <thead class="table-primary table-header">
            <tr>
              <th scope="col">NC</th>
              <th scope="col">Nombre</th>
              <th scope="col">Carrera</th>
              <th scope="col">NSS</th>
              <th scope="col">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of data" (click)="showFormValues(student)">
              <th scope="row">{{ student.controlNumber }}</th>
              <td>{{ student.fullName }}</td>
              <td>{{ student.career }}</td>
              <td>{{ student.nss }}</td>
              <td>
                <div style="display: flex;">
                  <!-- <button type="button" (click)="showFormValues(student)" style="margin-right: 5px;" class="btn btn-login btn-sm">
                    Ver
                  </button> -->
                  <button type="button" (click)="generatePDF(student)" class="btn btn-itt btn-sm">
                    Imprimir
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="showTable" class="table-responsive d-block d-lg-none">
        <table class="table table-bordered table-hover table-striped">
          <thead class="table-primary table-header">
            <tr>
              <th scope="col">NC</th>
              <th scope="col">Nombre</th>
              <th scope="col">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of data" (click)="showFormValues(student)">
              <th scope="row">{{ student.controlNumber }}</th>
              <td>{{ student.fullName }}</td>
              <td>
                <div style="display: flex;">
                  <!-- <button type="button" (click)="showFormValues(student)" style="margin-right: 5px;" class="btn btn-login btn-sm">
                      Ver
                    </button> -->
                  <button type="button" (click)="generatePDF(student)" class="btn btn-itt btn-sm">
                    Imprimir
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="showNotFound">
        <div class="card text-center">
          <div class="card-body">
            <h3 class="card-title">No hay resultados!!!</h3>
          </div>
        </div>
      </div>
      <!-- <div>
        <button type="button" class="btn btn-login col-12" (click)="newStudent()">
          Nuevo
        </button>
      </div> -->

    </div>
  </div>
</div>

<div class="center">
  <app-loader [loading]="loading"></app-loader>
</div>